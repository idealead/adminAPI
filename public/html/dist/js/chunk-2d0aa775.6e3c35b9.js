(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0aa775"],{"10aa":function(e,t,a){"use strict";a("536e"),a("c9a0"),a("df34"),a("cb1d"),a("e314"),a("faf7"),a("57d6"),a("d6b5"),a("6763"),a("20a8"),a("9b70"),a("9757"),a("068d"),a("c4e7"),a("f8e0"),a("5f5a"),a("acf5"),a("ae69"),a("bf55"),a("89cc"),a("323e"),a("b3a0"),a("70997"),a("08e9"),a("343d"),a("d849"),a("c1e0"),a("8e76"),a("9d96"),a("a3bd"),a("5ab7"),a("af5d"),a("bdbb"),a("429e"),a("2df1"),a("c20b"),a("1aa6"),a("808d"),a("ee95"),a("cb16"),a("d63e"),a("c96f"),a("6254"),a("90e5"),a("3108");var i=a("fd4b"),n=a("2ff6"),r=a("2427"),o=a.n(r),c=a("075f"),l=a("391c"),s=a.n(l);t["a"]={resolve:null,reject:null,window_w:1500,window_h:1500,template_name:"",origin_preview_img:"",r_app:null,logoFileId:"",mainFileId:"",img_app:null,mainStage_container:null,container_arr:[],active_log:[],ctrl_arr:[],material_id:[],originMian_obj:{},token:"",tempId:0,render_data:[],canvas_width:0,canvas_height:0,project_m_comp:[{name:"text",chinese:"文案"},{name:"slogan",chinese:"slogan"},{name:"product",chinese:"产品图"},{name:"logo",chinese:"logo"},{name:"ornament",chinese:"装饰"},{name:"model",chinese:"模特"},{name:"code",chinese:"二维码"},{name:"other",chinese:"版权信息"},{name:"background",chinese:"背景"}],changeTitle:"",changeSubtitle:"",changeLogo:"",changeMain:"",expand:!1,o_w:750,o_h:1334,standard:"",arc_title:null,arc_subtitle:null,arc_titleImg:null,arc_subtitleImg:null,arc_titleMid:"",arc_titleMid_index:0,arc_subtitleMid:"",arc_subtitleMid_index:0,split:!1,splitData:[],father_id:"",defaultTextFamily:"defaultSTSong",initData:function(e){var t=this;if(t.mainStage_container=null,t.container_arr.length=0,t.active_log.length=0,t.ctrl_arr.length=0,t.template_name="",t.render_data.length=0,t.origin_preview_img="",t.changeTitle="",t.changeSubtitle="",t.changeLogo="",t.changeMain="",t.logoFileId="",t.mainFileId="",t.originMian_obj={},t.arc_title=null,t.arc_subtitle=null,t.arc_titleImg=null,t.arc_subtitleImg=null,t.arc_titleMid="",t.arc_subtitleMid="",t.splitData=[],e.tempId&&(t.tempId=e.tempId),e.changeTitle&&(t.changeTitle=e.changeTitle),e.changeSubtitle&&(t.changeSubtitle=e.changeSubtitle),e.changeLogo&&(t.changeLogo=e.changeLogo),e.changeMain&&(t.changeMain=e.changeMain),e.logoFileId&&(t.logoFileId=e.logoFileId),e.mainFileId&&(t.mainFileId=e.mainFileId),e.token&&(t.token=e.token),e.expand){t.expand=e.expand;var a=t.o_h/t.o_w,i=e.height/e.width;t.standard=i>=a?"width":"height"}else t.expand=!1;e.split&&e.splitData&&e.splitData.length>0&&(t.split=e.split,t.splitData=e.splitData),t.r_app=e.app},tempInit:function(e){var t=this;return new Promise((function(a,i){t.resolve=a,t.reject=i,t.initData(e),t.tempId=parseInt(t.tempId);var n=t.split?2:1;o()({method:"post",url:"//ht.idealead.hbindex.com/api/template/find_template_by_id/template_id/".concat(t.tempId,".html"),data:{condition:n},headers:{my_flag:"1"}}).then((function(a){for(var i=0;i<a.data.data.material_content.length;i++){var n=JSON.parse(a.data.data.material_content[i].content);t.render_data.push(n),"arc_title"==n.children[0].ass_children[0].role?(t.arc_titleMid=JSON.parse(a.data.data.material_content[i].id),t.arc_titleMid_index=i):"arc_subtitle"==n.children[0].ass_children[0].role&&(t.arc_subtitleMid=JSON.parse(a.data.data.material_content[i].id),t.arc_subtitleMid_index=i)}t.canvas_width=t.expand?parseInt(e.width):parseInt(a.data.data.template_width),t.canvas_height=t.expand?parseInt(e.height):parseInt(a.data.data.template_height),t.template_name=a.data.data.template_name,t.origin_preview_img=a.data.data.preview_img,t.father_id=a.data.data.father_id,t.initPixiApp()})).catch((function(e){t.reject(e)}))}))},initPixiApp:function(){var e=this;e.r_app.view.id="pixiCanvas";var t=new c["Container"];t.width=e.canvas_width,t.height=e.canvas_height,t.position.set((e.window_w-e.canvas_width)/2,(e.window_h-e.canvas_height)/2),t.accessible=!0,e.mainStage_container=t,e.r_app.view.style.width=e.window_w+"px",e.r_app.view.style.height=e.window_h+"px",e.r_app.stage.addChild(e.mainStage_container),e.r_app.stage.width=e.window_w,e.r_app.stage.height=e.window_h;var a=new c["Graphics"];a.beginFill(15132410,0),a.drawRect(0,0,e.window_w,e.window_h),a.endFill(),a.position.set(0,0),e.r_app.stage.addChild(a),e.renderTemplate()},renderTemplate:function(){var e=this,t=e.render_data;e.r_app.stage.children[0].removeChildren();for(var a=[],i="",r={},o=0;o<t.length;o++)for(var c=0;c<t[o].children[0].ass_children.length;c++){if("image"==t[o].children[0].ass_children[c].type||"svg"==t[o].children[0].ass_children[c].type){var l=t[o].children[0].ass_children[c].src;if("logo"==t[o].children[0].ass_children[c].role&&e.changeLogo&&""!==e.changeLogo&&(l=e.changeLogo,t[o].children[0].ass_children[c].file_id=e.logoFileId,t[o].children[0].ass_children[c].src=e.changeLogo),"main"==t[o].children[0].ass_children[c].role&&e.changeMain&&""!==e.changeMain){if(i=l,t[o].children[0].ass_children[c].size&&t[o].children[0].ass_children[c].size.width&&t[o].children[0].ass_children[c].size.height){var s={width:null,height:null};s.width=t[o].children[0].ass_children[c].size.width<200?200:t[o].children[0].ass_children[c].size.width,s.height=t[o].children[0].ass_children[c].size.height<200?200:t[o].children[0].ass_children[c].size.height,e.originMian_obj["".concat(t[o].children[0].ass_children[c].id)]=s}l=e.changeMain,t[o].children[0].ass_children[c].file_id=e.mainFileId,t[o].children[0].ass_children[c].src=e.changeMain}if("arc_titleImg"==t[o].children[0].ass_children[c].role||"arc_subtitleImg"==t[o].children[0].ass_children[c].role){if(e.splitData&&(t[o].children[0].ass_children[c].replacePosition||0==t[o].children[0].ass_children[c].replacePosition)&&e.split){var h=t[o].children[0].ass_children[c],d=e.replaceVolution(h,"arc"),_=Object(n["a"])(d,4);h.file_id=_[0],h.src=_[1],h.size=_[2],h.arc=_[3],l=t[o].children[0].ass_children[c].src}"arc_titleImg"==t[o].children[0].ass_children[c].role?e.arc_titleImg=t[o].children[0].ass_children[c]:"arc_subtitleImg"==t[o].children[0].ass_children[c].role&&(e.arc_subtitleImg=t[o].children[0].ass_children[c])}if((t[o].children[0].ass_children[c].replacePosition||0==t[o].children[0].ass_children[c].replacePosition)&&e.split&&"arc_titleImg"!=t[o].children[0].ass_children[c].role&&"arc_subtitleImg"!=t[o].children[0].ass_children[c].role){var p=e.replaceVolution(t[o].children[0].ass_children[c],"normal"),g=Object(n["a"])(p,2);t[o].children[0].ass_children[c].file_id=g[0],t[o].children[0].ass_children[c].src=g[1],l=t[o].children[0].ass_children[c].src}e.r_app.loader.resources[l]||a.push(l)}if("text"==t[o].children[0].ass_children[c].type){var m=t[o].children[0].ass_children[c];if(e.defaultTextFamily.includes(m.style.fontFamily))continue;r["".concat(m.style.fontFamily)]=(r["".concat(m.style.fontFamily)]?r["".concat(m.style.fontFamily)]:"")+m.text}}a=Array.from(new Set(a)),e.originImg(i,(function(){e.r_app.loader.add(a,{crossOrigin:!0}).load((function(){0===Object.keys(r).length?e.renderF(t):e.getfontFamilyBack(r).then((function(){setTimeout((function(){e.renderF(t)}),50)})).catch((function(t){e.reject(t)}))}))}))},getfontFamilyBack:function(e){var t=this;return new Promise((function(a,n){t.getAllfontFamily(e).then((function(e){if("stf"===e)return a(),!1;for(var r=[],c=0;c<e.length;c++)1===e[c].data.code&&(r=[].concat(Object(i["a"])(r),Object(i["a"])(t.getCssWoff(e[c].data.path,e[c].data.woffPath))),t.dynamicLoadCss("//font.idealead.hbindex.com"+e[c].data.path));o.a.all(r).then((function(e){setTimeout((function(){a()}),200)})).catch((function(e){n(e)}))})).catch((function(e){n(e)}))}))},getCssWoff:function(e,t){return[o()({headers:{Accept:"text/css,*/*;q=0.1"},method:"get",url:"//font.idealead.hbindex.com".concat(e,"?my_flag=1"),responseType:"ms-stream"}),o()({method:"get",url:"//font.idealead.hbindex.com".concat(t),responseType:"ms-stream"})]},dynamicLoadCss:function(e){var t=document.getElementsByTagName("head")[0],a=document.createElement("link");a.type="text/css",a.rel="stylesheet",a.href="".concat(e,"?my_flag=1"),t.appendChild(a)},fontPost:function(e){var t={user_id:1,font_name:e.font_name,text:e.text,my_flag:1};return o()({method:"post",url:"//papi.idealead.hbindex.com/cutFont",data:t,headers:{my_flag:"1"}})},getAllfontFamily:function(e){var t=this,a=[];for(var i in e)t.defaultTextFamily.includes(i)||a.push(t.fontPost({font_name:"".concat(i),text:e[i]}));return o.a.all(a)},renderF:function(e){for(var t=this,a=0;a<e.length;a++)for(var i=0;i<e[a].children[0].ass_children.length;i++){var n=e[a].children[0].ass_children[i];n.association_id=e[a].children[0].association_id,"image"==e[a].children[0].ass_children[i].type||"svg"==e[a].children[0].ass_children[i].type?t.newContainer(n,!0):"text"==e[a].children[0].ass_children[i].type&&("title"==n.role&&""!==t.changeTitle&&(n.text=t.changeTitle),"subtitle"==n.role&&""!==t.changeSubtitle&&(n.text=t.changeSubtitle),"arc_title"==n.role?(t.arc_title=s.a.cloneDeep(n),t.changeTitle&&(t.arc_title.text=t.changeTitle)):"arc_subtitle"==n.role?(t.arc_subtitle=s.a.cloneDeep(n),t.changeSubtitle&&(t.arc_subtitle.text=t.changeSubtitle)):t.newContainerText(n,!0))}if(t.arc_title&&t.arc_titleImg){var r=t.arc_title.text.split(""),o="number"===typeof t.arc_title.textReplace?t.arc_title.textReplace:null;t.renderARC("arc_title",r,o)}if(t.arc_subtitle&&t.arc_subtitleImg){var c=t.arc_subtitle.text.split(""),l="number"===typeof t.arc_subtitle.textReplace?t.arc_subtitle.textReplace:null;t.renderARC("arc_subtitle",c,l)}t.renderStage();for(var h={},d=0;d<t.container_arr.length;d++)if(""!==t.container_arr[d].cont.children[0].association_name){var _=t.container_arr[d].cont.children[0].association_name;h[_]||(h[_]=[]),h[_].push(t.container_arr[d].cont.children[0])}var p=Object.keys(h);if(p.length>0){for(var g=0;g<p.length;g++){var m=p[g];t.ctrl_arr=h[m],t.createAssociation(m,h[m][0].m_comp_name,!0)}t.renderStage(),t.ctrl_arr&&(t.ctrl_arr.length=0)}t.pushActiveLog(!0),setTimeout((function(){t.saveMould(t.template_name)}),20)},replaceVolution:function(e,t){var a=this,i=a.splitData.filter((function(t,a,i){if(t.position==e.replacePosition)return t}));return"arc"==t?[i[0].file_id,i[0].src,i[0].size,i[0].arc]:[i[0].file_id,i[0].src]},renderARC:function(e,t,a){var i=this,n=null,r=null;"arc_title"==e?(n=s.a.cloneDeep(i.arc_title),r={position:s.a.cloneDeep(i.arc_titleImg.position),size:{width:i.arc_titleImg.size.width,height:i.arc_titleImg.size.height},arc:s.a.cloneDeep(i.arc_titleImg.arc)}):"arc_subtitle"==e&&(n=s.a.cloneDeep(i.arc_subtitle),r={position:s.a.cloneDeep(i.arc_subtitleImg.position),size:{width:i.arc_subtitleImg.size.width,height:i.arc_subtitleImg.size.height},arc:s.a.cloneDeep(i.arc_subtitleImg.arc)});for(var o=1;o<=t.length;o++){var c=t[o-1],l=s.a.cloneDeep(n);l.id+="".concat(o);var h=parseInt(r.arc.arc_deg)/t.length/2,d=void 0,_=0;d=r.position.x;var p=90+parseInt(r.arc.arc_deg)/2,g=void 0,m=0;"down"==r.arc.direction?(_=r.position.y-r.size.height/2+parseInt(r.arc.centerToTop)+parseInt(r.arc.radius),g=d+parseInt(r.arc.radius)*Math.cos((-h*(2*o-1)+p)*Math.PI/180),m=_-parseInt(r.arc.radius)*Math.sin((-h*(2*o-1)+p)*Math.PI/180),p=(90-(p-h*(2*o-1)))*Math.PI/180):(p=-p,_=r.position.y+r.size.height/2-parseInt(r.arc.centerToTop)-parseInt(r.arc.radius),g=d+parseInt(r.arc.radius)*Math.cos((h*(2*o-1)+p)*Math.PI/180),m=_-parseInt(r.arc.radius)*Math.sin((h*(2*o-1)+p)*Math.PI/180),p=(-90-(p+h*(2*o-1)))*Math.PI/180),l.position.x=g,l.position.y=m,l.text=c,l.rotation=p,l.role="normal",l.textReplace=a,i.newContainerText(l,!0,!0)}},originImg:function(e,t){var a=this;if(""==e)t();else{var i=Object.keys(a.originMian_obj);i=i.length,i>0?t():a.r_app.loader.add(e,{crossOrigin:!0}).load((function(){if(/.svg$/.test(e));else{var i=new c["Sprite"](a.r_app.loader.resources[e].texture);a.originMian_obj.normal={width:0,height:0},a.originMian_obj.normal.width=i.width<200?200:i.width,a.originMian_obj.normal.height=i.height<200?200:i.height,t()}}))}},newContainer:function(e,t){var a=this;e.type="image",e.id="".concat(e.id),a.addContainer(e,e.position),a.loadSprite(e,t)},newContainerText:function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this;e.type="text",e.id="".concat(e.id),i.addContainer(e,e.position,a),i.addText(e,t,a)},addContainer:function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this,n=new c["Container"];n.width=i.canvas_width,n.height=i.canvas_height,n.position.set(t.x,t.y),n.type="".concat(e.type,"_c"),n.rotation_num=0,i.containerArrAdd(e.m_comp_name,n,e.id,a)},containerArrAdd:function(e,t,a,n){var r=this;if(n){var o=r.findFinalIndex(e),c=[],l=[{cont:t,index:0,name:a,m_comp_name:e}],s=[];if(o==r.container_arr.length-1||0==o&&0==r.container_arr.length)r.container_arr=[].concat(Object(i["a"])(r.container_arr),l);else{for(var h=0;h<r.container_arr.length;h++)h<=o?c.push(r.container_arr[h]):h>o&&s.push(r.container_arr[h]);r.container_arr=[].concat(c,l,s)}r.sortContainerArr(!0)}else r.container_arr.push({cont:t,index:0,name:a,m_comp_name:e})},findFinalIndex:function(e){var t=this,a=-100,i=t.project_m_comp.length-1;if(0==t.container_arr.length)return a=0,a;if(t.project_m_comp[0].name==e&&t.container_arr.length>0)return a=t.container_arr.length-1,a;if(t.container_arr.map((function(t,i,n){t.m_comp_name==e&&(a=i)})),-100!=a)return a;if(t.project_m_comp[i].name==e)return a=-1,a;for(var n=0;n<t.project_m_comp.length;n++)if(t.project_m_comp[n].name==e)return t.findFinalIndex(t.project_m_comp[n+1].name)},sortContainerArr:function(e){var t=this;t.container_arr.map((function(t,a,i){t.index=a,!e||"image_c"!=t.cont.type&&"text_c"!=t.cont.type||(t.cont.rotation_num=0)}))},loadSprite:function(e,t){var a,i=this,n=s.a.cloneDeep(e),r=n.src;i.r_app.loader.resources[r]&&(/.svg$/.test(r)||(a=new c["Sprite"](i.r_app.loader.resources[r].texture),i.addImg(a,n,t)))},addImg:function(e,t,a){var i=this;if(e.interactive=!0,e.anchor.set(.5),e.cursor="grab",e.name="".concat(t.id),e.file_id=t.file_id,e.type="image",e.srcData=t.src,e.rotation_num=0,e.originalw=s.a.cloneDeep(e.width),e.originalh=s.a.cloneDeep(e.height),e.position.set(0,0),e.association_name="",e.m_comp_name=t.m_comp_name,e.lock=!1,e.role="normal",t.skew&&e.skew.set(t.skew.x,t.skew.y),"number"===typeof t.hueNumber){e.hueNumber=t.hueNumber,t.hueNumber*=360;var n=new c["filters"].ColorMatrixFilter;n.hue(t.hueNumber,!0),e.filters=[n]}if(a&&(e.rotation=t.rotation,e.rotation_num=t.rotation,e.alpha=t.alpha,e.scale.set(t.scale),e.association_name=t.association_id,e.role=t.role),"logo"==e.role&&i.changeLogo){if(e.width>=e.height){if(e.width>t.size.width){var r=t.size.width<50?50:t.size.width;e.scale.set(r/e.width)}}else if(e.height>t.size.height){var o=t.size.height<70?70:t.size.height;e.scale.set(o/e.height)}}else if("main"==e.role&&i.originMian_obj["".concat(t.id)]){var l=i.originMian_obj["".concat(t.id)].width/i.originMian_obj["".concat(t.id)].height,h=e.originalw/e.originalh;h>=l?e.scale.set(i.originMian_obj["".concat(t.id)].width/e.originalw):e.scale.set(i.originMian_obj["".concat(t.id)].height/e.originalh)}else if("main"==e.role&&i.originMian_obj.normal){var d=i.originMian_obj.normal.width/i.originMian_obj.normal.height,_=e.originalw/e.originalh;_>=d?e.scale.set(i.originMian_obj.normal.width/e.originalw):e.scale.set(i.originMian_obj.normal.height/e.originalh)}if(i.expand){if("width"==i.standard&&"bg"!=e.role||"height"==i.standard&&"bg"==e.role){var p=t.scale*i.canvas_width/i.o_w;e.scale.set(p)}else if("height"==i.standard&&"bg"!=e.role||"width"==i.standard&&"bg"==e.role){var g=t.scale*i.canvas_height/i.o_h;e.scale.set(g)}i.container_arr[i.findCont(t.id)].cont.position.set(t.position.x/i.o_w*i.canvas_width,t.position.y/i.o_h*i.canvas_height)}else i.container_arr[i.findCont(t.id)].cont.addChild(e)},addText:function(e,t,a){var i=this,n=null;if(i.expand){var r=!1;if("width"==i.standard)if(e.size.width/i.o_w+.1>=e.size.width/i.canvas_width&&e.size.width/i.canvas_width<1)r=!0;else{var o=e.style.fontSize/i.o_w,l=e.style.lineHeight/i.o_w;e.style.fontSize=i.canvas_width*o,e.style.lineHeight=i.canvas_width*l}else if(e.size.height/i.o_h+.1>=e.size.height/i.canvas_height&&e.size.height/i.canvas_height<1)r=!0;else{var s=e.style.fontSize/i.o_h,h=e.style.lineHeight/i.o_h;e.style.fontSize=i.canvas_width*s,e.style.lineHeight=i.canvas_width*h}if(n=new c["Text"]("".concat(e.text),e.style),"title"==e.role||"subtitle"==e.role){var d={x:0,y:0},_=0,p=0;"width"==i.standard?(_=50/i.o_w,p=i.canvas_width*_*3/2,_=i.canvas_width*_):(p=75/i.o_h,_=i.canvas_height*p/3*2,p=i.canvas_height*p),d.x=_+n.width/2,d.y=p+n.height/2,"subtitle"==e.role&&(d.y+=r?75:75/i.o_h*i.canvas_height),i.container_arr[i.findCont(e.id)].cont.position.set(d.x,d.y)}else i.container_arr[i.findCont(e.id)].cont.position.set(e.position.x/i.o_w*i.canvas_width,e.position.y/i.o_h*i.canvas_height)}else n=new c["Text"]("".concat(e.text),e.style);if(n.interactive=!0,n.anchor.set(.5),n.cursor="grab",n.name=e.id,n.type="text",n.rotation_num=0,n.originalw=n.width,n.originalh=n.height,n.ofonts=n.style.fontSize,n.position.set(0,0),n.lineHeightM=10,n.association_name="",n.m_comp_name=e.m_comp_name,n.lock=!1,n.role="normal",e.skew&&n.skew.set(e.skew.x,e.skew.y),"number"===typeof e.textReplace&&(n.textReplace=e.textReplace),e.textReverse&&(n.textReverse=!0),"number"===typeof e.hueNumber){n.hueNumber=e.hueNumber,e.hueNumber*=360;var g=new i.mypixi.filters.ColorMatrixFilter;g.hue(e.hueNumber,!0),n.filters=[g]}t&&(n.rotation=e.rotation,n.rotation_num=e.rotation,n.alpha=e.alpha,n.association_name=e.association_id,n.ofonts=e.style.fontSize,n.role=e.role),a||(n.type="notSave"),i.container_arr[i.findCont(e.id)].cont.addChild(n),e.text_num?n.text_num=e.text_num:n.text_num=n.width/n.style.fontSize},findCont:function(e){for(var t=this,a=-1,i=0;i<t.container_arr.length;i++)t.container_arr[i].name==e&&(a=i);return a},renderStage:function(){var e=this;e.r_app.stage.children[0].removeChildren();for(var t=0;t<e.container_arr.length;t++)e.mainStage_container.addChild(e.container_arr[t].cont),e.container_arr[t].cont.buttonMode=!1;e.r_app.renderer.render(e.r_app.stage)},createAssociation:function(e,t,a){for(var i=this,n=[],r=0;r<i.ctrl_arr.length;r++)n.push(i.findCont(i.ctrl_arr[r].name));n.sort((function(e,t){return e-t}));for(var o=[],l=[],s=[],h=0;h<i.container_arr.length;h++)h<n[n.length-1]?i.container_arr[h].cont.children[0].association_name!==e&&o.push(i.container_arr[h]):h>n[n.length-1]&&i.container_arr[h].cont.children[0].association_name!==e&&s.push(i.container_arr[h]),i.container_arr[h].cont.children[0].association_name==e&&l.push(i.container_arr[h]);i.container_arr=[].concat(o,l,s),i.sortContainerArr(!0);for(var d=-1,_=0;_<i.container_arr.length;_++)if(i.container_arr[_].cont.children[0].association_name==e){d=_;break}var p=new c["Container"];p.width=i.canvas_width,p.height=i.canvas_height,p.pivot.set(0,0),p.rotation_num=0,p.name=e,i.container_arr.splice(d,0,{cont:p,index:n[0],name:e,m_comp_name:t}),i.sortContainerArr(!0),i.createAssociationRect(p,e,a)},createAssociationRect:function(e,t,a){for(var i=this,n=[],r=[],o=0;o<i.ctrl_arr.length;o++)for(var l=i.ctrl_arr[o].vertexData,s=0;s<l.length;s++)s%2==0||0==s?n.push(l[s]):r.push(l[s]);n.sort((function(e,t){return e-t})),r.sort((function(e,t){return e-t}));var h=n[n.length-1]-n[0],d=r[r.length-1]-r[0];e.position.set(0,0);var _=new c["Graphics"];_.interactive=!0,_.width=h,_.height=d,_.originalw=h,_.originalh=d,_.beginFill(15132410,.1),_.alpha=.01,_.drawRect(0,0,h,d),_.endFill(),_.name=t,_.association_name=t,_.lock=!1,_.type="association_gap_notT",_.rotation_num=0,_.x=n[0]-(i.window_w-i.canvas_width)/2,_.y=r[0]-(i.window_h-i.canvas_height)/2,_.cursor="grab",_.centerX=_.x+_.width/2,_.centerY=_.y+_.height/2,i.ctrl_arr.push(_),e.addChild(_)},addACtrlarr:function(e){for(var t=this,a=0;a<t.container_arr.length;a++)t.container_arr[a].cont.children[0].association_name==e&&t.ctrl_arr.push(t.container_arr[a].cont.children[0])},pushActiveLog:function(e){for(var t=this,a="",i={m_comp_name:"product",children:[{ass_children:[],association_id:""}]},n={src:"",type:"",id:"",m_comp_name:"product",rotation:0,scale:1,position:{x:0,y:0},text:"",style:{},alpha:1,size:{},skew:{}},r=[],o={},c=0;c<t.container_arr.length;c++)if("temporary_rect"!==t.container_arr[c].cont.children[0].type&&"association_gap_notT"!==t.container_arr[c].cont.children[0].type){if("notSave"==t.container_arr[c].cont.children[0].type&&c!=t.container_arr.length-1)continue;if("notSave"==t.container_arr[c].cont.children[0].type&&c==t.container_arr.length-1);else{var l=t.container_arr[c].cont.children[0],h=s.a.cloneDeep(n);if((""==l.association_name||""!==l.association_name&&l.association_name!==a)&&(o.children&&o.children[0].ass_children.length>=1&&r.push(o),o=s.a.cloneDeep(i)),""!==l.association_name&&(o.children[0].association_id=l.association_name,a=l.association_name),"image"==l.type)h.src=l.srcData,h.type="image",h.file_id=l.file_id,h.size.width=l.width,h.size.height=l.height;else if("text"==l.type){h.type="text";var d={fontFamily:"default",fontSize:50,lineHeight:60,fontStyle:"normal",fontWeight:"bold",fill:"#000",stroke:"#000",strokeThickness:0,dropShadow:!1,dropShadowColor:"#000000",dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowDistance:18,wordWrap:!0,wordWrapWidth:300,breakWords:!0,padding:50,textBaseline:"Middle",trim:!1,whiteSpace:"normal",leading:0,letterSpacing:0,align:"left"};for(var _ in d)d[_]=l.style[_];h.style=d,h.style.fontSize=Math.floor(h.style.fontSize),h.text=l.text,h.size.width=l.width,h.size.height=l.height,h.textReplace=l.textReplace}h.id=l.name,h.rotation=l.rotation,h.scale=l.scale.x,h.position.x=l.parent.x,h.position.y=l.parent.y,h.alpha=l.alpha,h.role=l.role,h.skew={x:l.skew.x,y:l.skew.y},h.hueNumber=l.hueNumber||0,o.children[0].ass_children.push(h)}c==t.container_arr.length-1&&r.push(o)}t.active_log.length>=30&&t.active_log.splice(0,1),t.active_log.push(r)},saveMould:function(e){var t=this,a=s.a.cloneDeep(t.active_log[t.active_log.length-1]);t.getMaterialData(a).then((function(a){var i=a;t.uploadMaterial(e,i)})).catch((function(e){t.reject(e)}))},getMaterialData:function(e){for(var t=this,a=[],i=0;i<e.length;i++)a.push(t.getMd(e[i]));return Promise.all(a)},getMd:function(e){var t=this;return new Promise((function(a,i){var n={};if(1==e.children[0].ass_children.length)"image"==e.children[0].ass_children[0].type?(n.material_type="img",n.file_id=JSON.stringify([parseInt(e.children[0].ass_children[0].file_id)]),n.author="1",n.preview=parseInt(e.children[0].ass_children[0].file_id),n.content=JSON.stringify(e)):"text"==e.children[0].ass_children[0].type&&(n["material_type"]="text",n["author"]="1",n["dimension_id"]=0,n["content"]=JSON.stringify(e),n["text_content"]=e.children[0].ass_children[0].text),a(n);else if(e.children[0].ass_children.length>1){for(var r=[],c=0;c<e.children[0].ass_children.length;c++)"image"==e.children[0].ass_children[c].type&&r.push(e.children[0].ass_children[c].file_id);n.material_type="whole",n.file_id=JSON.stringify(r),n.author="1",t.addACtrlarr.bind(t)(r[0]);var l=t.toImage(!0),s=new FormData;s.append("upload_file_once",l),o()({method:"post",url:"//ht.idealead.hbindex.com/api/files/upload_file_once/author_id/1.html",data:s,headers:{my_flag:"1"}}).then((function(t){n.preview=t.data.data.file_id,n.content=JSON.stringify(e),a(n)})).catch((function(e){t.reject(e)}))}}))},toImage:function(e){var t,a,i,n=this,r=0,o=[];if(n.ctrl_arr.length>0){for(var l=0;l<n.ctrl_arr.length;l++)"association_gap_notT"==n.ctrl_arr[l].type&&(t=n.ctrl_arr[l].width,a=n.ctrl_arr[l].height,i=n.ctrl_arr[l].centerX,r=n.ctrl_arr[l].centerY);for(var h=0;h<n.ctrl_arr.length;h++){var d={};"association_gap_notT"!==n.ctrl_arr[h].type&&"text"!==n.ctrl_arr[h].type?(d={src:n.ctrl_arr[h].srcData,x:t/2-(i-n.ctrl_arr[h].parent.x),y:a/2-(r-n.ctrl_arr[h].parent.y),scale:n.ctrl_arr[h].scale.x,rotation:n.ctrl_arr[h].parent.rotation,type:n.ctrl_arr[h].type,alpha:n.ctrl_arr[h].alpha},o.push(d)):"text"==n.ctrl_arr[h].type&&(d=s.a.cloneDeep(n.ctrl_arr[h]),d.position.set(t/2-(i-n.ctrl_arr[h].parent.position.x),a/2-(r-n.ctrl_arr[h].parent.position.y)),o.push(d))}}n.img_app=null,n.img_app=new c["Application"]({backgroundColor:16711680,width:t,height:a,antialias:1});var _=new c["Container"];_.width=t,_.height=a,_.position.set(0,0),_=n.addImgTwo(_,o),n.img_app.stage.addChild(_);var p=n.img_app.renderer.plugins.extract.base64(n.img_app.stage);if(e)return n.dataURLtoFile(p,"association_img.png")},addImgTwo:function(e,t){var a=this;t=t.reverse();for(var i=0;i<t.length;i++)if("text"!==t[i].type){var n=new c["Sprite"](a.r_app.loader.resources[t[i].src].texture);n.anchor.set(.5),n.position.set(t[i].x,t[i].y),n.scale.set(t[i].scale),n.rotation=t[i].rotation,n.alpha=t[i].alpha,e.addChild(n)}else"text"==t[i].type&&e.addChild(t[i]);return e},dataURLtoFile:function(e,t){var a=e.split(","),i=a[0].match(/:(.*?);/)[1],n=atob(a[1]),r=n.length,o=new Uint8Array(r);while(r--)o[r]=n.charCodeAt(r);return new File([o],t,{type:i})},uploadMaterial:function(e,t){var a=this;a.material_id.length=0,a.uploadAllMaterial(t).then((function(t){for(var i=0;i<t.length;i++)a.material_id.push(parseInt(t[i].data.data.materialId));a.uploadTemp(e)})).catch((function(e){a.reject(e)}))},uploadMF:function(e){return o()({method:"post",url:"//ht.idealead.hbindex.com/api/material/upload_material.html",data:e,headers:{my_flag:"1"}})},uploadAllMaterial:function(e){for(var t=this,a=[],i=0;i<e.length;i++)a.push(t.uploadMF(e[i]));return Promise.all(a)},uploadImgF:function(e,t,a){var i=this;return o()({method:"post",url:"//ht.idealead.hbindex.com/api/files/upload_file_once/author_id/1.html",data:e,headers:{my_flag:"1"}}).then((function(e){t.bind(i)(e,a)})).catch((function(e){i.reject(e)}))},axiosTempF:function(e,t){var a=this,i={preview:e.data.data.file_id,author:1,material_content:JSON.stringify(t.material_id),name:t.mould_name,condition:1,t_width:a.canvas_width,t_height:a.canvas_height,level:"temporary",father_id:a.father_id};o()({method:"post",url:"//ht.idealead.hbindex.com/api/template/upload_template.html",data:i,headers:{my_flag:"1"}}).then((function(t){var i={origin_preview_img:a.origin_preview_img,renderTempId:t.data.data.templateId,render_preview_img:e.data.data.savepath};a.r_app.stage.removeChildren(),a.resolve(i)})).catch((function(e){a.reject(e)}))},uploadTemp:function(e){var t=this;""!=t.arc_titleMid&&t.material_id.splice(t.arc_titleMid_index,0,t.arc_titleMid),""!=t.arc_subtitleMid&&t.material_id.splice(t.arc_subtitleMid_index,0,t.arc_subtitleMid);var a=null;t.ClippingImage(t.r_app.renderer.plugins.extract.base64(t.r_app.stage,"image/jpeg",1),t.canvas_width,t.canvas_height,.9,(function(i){a=t.dataURLtoFile(i,"mould.jpg");var n=new FormData;n.append("upload_file_once",a),t.uploadImgF(n,t.axiosTempF,{material_id:t.material_id,mould_name:e})}))},downloadImg:function(e){fetch(e).then((function(e){return e.blob().then((function(e){var t=document.createElement("a"),a=window.URL.createObjectURL(e),i="myImg.png";t.href=a,t.download=i,t.click(),window.URL.revokeObjectURL(a)}))}))},ClippingImage:function(e,t,a,i,n){var r=this,o=new Image;o.src=e;var c=document.createElement("canvas"),l=c.getContext("2d"),s=document.createAttribute("width"),h=document.createAttribute("height");s.nodeValue=t,h.nodeValue=a,c.setAttributeNode(h),c.setAttributeNode(s),o.onload=function(){l.drawImage(o,(r.window_w-r.canvas_width)/2,(r.window_h-r.canvas_height)/2,t,a,0,0,t,a);var e=c.toDataURL("image/jpeg",i);n(e)}}}}}]);
//# sourceMappingURL=chunk-2d0aa775.6e3c35b9.js.map